---
import { Picture } from "astro:assets";

interface Props {
  latitude: number;
  longitude: number;
  zoom?: number;
  width?: number;
  height?: number;
  locationName?: string;
}

const {
  latitude,
  longitude,
  zoom = 12,
  width = 400,
  height = 400,
  locationName,
} = Astro.props;

const MAPBOX_ACCESS_TOKEN = import.meta.env.MAPBOX_ACCESS_TOKEN;

const mapboxUrl = `https://api.mapbox.com/styles/v1/mapbox/satellite-v9/static/pin-s+ff0000(${longitude},${latitude})/${longitude},${latitude},${zoom}/${width}x${height}@2x?access_token=${MAPBOX_ACCESS_TOKEN}`;
const googleMapsUrl = `https://www.google.com/maps?q=${latitude},${longitude}`;
const hasValidCoordinates = latitude && longitude;
---

{
  hasValidCoordinates && (
    <div class="relative mx-auto w-fit">
      <a
        href={googleMapsUrl}
        data-umami-event="Open Google Maps"
        target="_blank"
        rel="noopener noreferrer"
        class="block cursor-pointer overflow-hidden rounded-lg shadow-md"
        title="View in Google Maps">
        <Picture
          src={mapboxUrl}
          alt={`Map showing location at ${latitude}, ${longitude}`}
          class="h-auto w-full max-w-[300px] object-cover"
          formats={["avif"]}
          fallbackFormat="jpg"
          width={300}
          height={300}
          layout="constrained"
        />
      </a>
    </div>
  )
}
