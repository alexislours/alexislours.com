---
import { Picture } from "astro:assets";

interface Props {
  latitude: number;
  longitude: number;
  zoom?: number;
  width?: number;
  height?: number;
  locationName?: string;
}

const {
  latitude,
  longitude,
  zoom = 12,
  width = 400,
  height = 400,
  locationName,
} = Astro.props;

const MAPBOX_ACCESS_TOKEN = import.meta.env.MAPBOX_ACCESS_TOKEN;

const mapboxUrl = `https://api.mapbox.com/styles/v1/mapbox/satellite-v9/static/pin-s+ff0000(${longitude},${latitude})/${longitude},${latitude},${zoom}/${width}x${height}@2x?access_token=${MAPBOX_ACCESS_TOKEN}`;
const googleMapsUrl = `https://www.google.com/maps?q=${latitude},${longitude}`;
const hasValidCoordinates = latitude && longitude;
---

{
  hasValidCoordinates && (
    <div class="relative mx-auto w-fit">
      {locationName && (
        <div class="mb-3 rounded-lg bg-gray-50 p-3 text-sm">
          <div class="flex items-center gap-2">
            <svg
              class="h-4 w-4 text-gray-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
              />
            </svg>
            <span class="font-medium text-gray-700">{locationName}</span>
          </div>
        </div>
      )}

      <a
        href={googleMapsUrl}
        data-umami-event="Open Google Maps"
        target="_blank"
        rel="noopener noreferrer"
        class="block cursor-pointer overflow-hidden rounded-lg shadow-md"
        title="View in Google Maps">
        <Picture
          src={mapboxUrl}
          alt={`Map showing location at ${latitude}, ${longitude}`}
          class="h-auto w-full max-w-[300px] object-cover"
          formats={["avif"]}
          fallbackFormat="jpg"
          width={300}
          height={300}
          layout="constrained"
        />
      </a>
    </div>
  )
}
